let e=null,t=null,n=null,o=null,l=null,a=null,c=null,s=null,r=null;const i=["none","air-horn","aooga","applause","ding-ding","ding","drama","happy-tones","mario-coin","minecraft-eating","success","tada","xylophone"];let d=null,u={goal:40,pauseMs:500,op:"+",volume:.25,oneSound:i.indexOf("ding"),goalSound:i.indexOf("tada")},m=null,g={},p={count:0,accuracy:{},speed:{}},h=null,f=!1;function y(){return new Date}function E(e){return e.toLocaleDateString("sv")}function v(e,t){let n=new Date(e);return n.setDate(n.getDate()+t),n}function I(e){return v(e,-e.getDay())}function w(e,t,n){let o=t-e+1,l=o>=3&&n>=e&&n<=t;if(o<=1)return t;l&&o--;let a=e+Math.floor(Math.random()*o);return a===n&&l&&(a=t),a}let x=0,L=20,S=0,T=20;function b(){let l=u.op,a=parseInt(e.innerText),s=parseInt(t.innerText),r=null,i=function(){const e=u.goal-m.count%u.goal;return m.redo?.length>=e?m.redo.shift():null}();i?(a=parseInt(i[0]),l=i[1],s=parseInt(i[2]),"Ã·"===l&&(r=a/s)):"+"===l?(a=w(Math.max(0,x),Math.min(12,L),a),s=w(Math.max(0,S),Math.min(12,T),s)):"-"===l?(a=w(Math.max(0,S,x),Math.min(20,L),a),s=w(Math.max(0,S),Math.min(a,T),s)):"x"===l?(a=w(Math.max(0,x),Math.min(12,L),a),s=w(Math.max(0,S),Math.min(12,T),s)):(r=w(Math.max(1,x),Math.min(12,L),r),s=w(Math.max(1,S),Math.min(12,T),s)),"+"===l?r=a+s:"-"===l?r=a-s:"x"===l?r=a*s:a=r*s,d={answer:r,wasEverIncorrect:!1},M(),c.classList.remove("correct"),c.classList.remove("correct-instant"),e.innerText=a,n.innerText=l,t.innerText=s,o.value="",o.focus()}function M(){d&&(d.startTime=y())}function B(){const l=y(),a=parseInt(o.value);if(null!==d&&""!==o.value)if(a===d.answer){E(l)!==m.date&&C();const o=l-d.startTime;if(m.count++,o<6e4){const l=[e.innerText,n.innerText,t.innerText,o,d.wasEverIncorrect];m.telemetry??=[],m.telemetry.push(l),V(l),(d.wasEverIncorrect||o>=6e3)&&(m.redo??=[],m.redo.push(l))}try{window.localStorage.setItem("today",JSON.stringify(m))}catch{f||(f=!0,A("Can't save progress or settings with cookies disabled."))}c.classList.add(u.pauseMs>=500?"correct":"correct-instant"),d=null,k(),m.count>0&&m.count<=3*u.goal&&m.count%u.goal==0?(F(r),A("Yay!")):F(s),setTimeout(b,u.pauseMs??250)}else a.toString().length>=d.answer.toString().length&&(d.wasEverIncorrect=!0)}function k(){m.count<u.goal?(l.className="bronze",a.className=""):m.count<2*u.goal?(l.className="silver",a.className="bronze"):m.count<3*u.goal?(l.className="gold",a.className="silver"):(l.className="",a.className="gold");const e=m.count%u.goal/u.goal;l.style.backgroundSize=`${Math.floor(100*e)}% 100%`}function $(){E(y())!==m.date&&(A("Welcome Back!"),C()),window.setTimeout($,36e5)}function C(){const e=E(y());try{const t=window.localStorage;u={...u,...JSON.parse(t.getItem("settings"))},g=JSON.parse(t.getItem("history"))??g;const n=JSON.parse(t.getItem("today"));n&&(n.date===e?m=n:(g[n.date]=n,t.setItem("history",JSON.stringify(g)),m=null))}catch{}const t=new URLSearchParams(location.search),o=parseInt(t.get("g"));o&&(u.goal=o);const l=t.get("o");"+"!==l&&"-"!==l&&"x"!==l&&"Ã·"!==l||(u.op=l);const a=parseInt(t.get("v"));a>=0&&a<=100&&(u.volume=a/100),x=parseInt(t.get("u0"))||0,L=parseInt(t.get("u1"))||20,S=parseInt(t.get("l0"))||0,T=parseInt(t.get("l1"))||20,null==m&&(m={date:e,count:0,telemetry:[]}),n.innerText=u.op,k(),q(),window.setTimeout(D,50)}function N(e){const t=["+","-","x","Ã·"];return t[(t.indexOf(e)+1)%t.length]}function O(){n.innerText=u.op=N(u.op),_(),b()}function D(){s=z(u.oneSound??i.indexOf("ding"),s),r=z(u.goalSound??i.indexOf("tada"),r)}function z(e,t){t?.pause();const n=i[(e||0)%i.length];if("none"===n||0===u.volume)return null;if(t?.src?.indexOf(`/${n}.mp3`)>=0)return t;{const e=new Audio(`./audio/${n}.mp3`);return e.load(),e}}function F(e,t){if(null==e)return;e.pause(),e.currentTime=0,e.volume=t??u.volume??1;const n=e.play();n&&n.catch((e=>{}))}function H(e){let t=document.createElement("template");t.innerHTML='<svg class="close-button" title="Close"><use href="#close"></use></svg>';const n=document.getElementById(e);n.children?.[0]?.prepend(t.content),n.classList.remove("hidden"),document.querySelectorAll(".close-button").forEach((e=>e.addEventListener("click",J)))}function J(){document.querySelectorAll(".overlay").forEach((e=>e.classList.add("hidden"))),M(),o.focus()}function U(e){e.stopPropagation()}function A(e){const t=document.getElementById("temp-message");t.innerHTML=e,t.classList.remove("hidden"),t.classList.remove("show-message"),window.setTimeout((()=>t.classList.add("show-message")),10)}function q(e){e??=60,p={count:0,accuracy:{},speed:{},rollup:{accuracy:{},speed:{}}};for(const e of m.telemetry)V(e);const t=E(v(y(),-1*Math.abs(e)));for(let e in g)if(e>=t){let t=g[e].telemetry;if(t)for(const e of t)V(e)}}function V(e){const t=p.accuracy,o=p.speed,l=p.rollup.accuracy,a=p.rollup.speed,c=e[0],s=e[1],r=e[2],i=e[3],d=e[4];t[s]??={},t[s][c]??={},t[s][c][r]??=[0,0],t[s][c][r][0]+=d?0:1,t[s][c][r][1]+=1,l[s]??={},"+"!==n&&"x"!==n||(l[s][c]??=[0,0],l[s][c][0]+=d?0:1,l[s][c][1]+=1),l[s][r]??=[0,0],l[s][r][0]+=d?0:1,l[s][r][1]+=1,o[s]??={},o[s][c]??={},o[s][c][r]??=[],o[s][c][r].push(i),a[s]??={},"+"!==n&&"x"!==n||(a[s][c]??=[],a[s][c].push(i)),a[s][r]??=[],a[s][r].push(i),p.count++}function G(e,t,n){if("-"===t&&e-n<0)return null;const o="Ã·"===t?e*n:e,l=p.speed?.[t]?.[`${o}`]?.[`${n}`],a=document.createElement("td");if(a.title=`${o} ${t} ${n}`,l){l.sort(((e,t)=>e-t));const e=l[Math.floor(l.length/2)],t=e/1e3;a.innerText=t.toLocaleString("en-US",{minimumFractionDigits:t<9.5?1:0,maximumFractionDigits:1}),a.className=W(e)}return a}function P(e,t,n){if("-"===t&&e-n<0)return null;const o="Ã·"===t?e*n:e,l=p.accuracy?.[t]?.[`${o}`]?.[`${n}`],a=document.createElement("td");if(a.title=`${o} ${t} ${n}`,l){const e=l[0]/l[1]*100;a.innerText=`${e.toLocaleString("en-US",{maximumFractionDigits:0})}`,a.className=j(e)}return a}function R(e,t){e??="+";let n=null,o=null;"-"===e?(n=[20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0],o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]):"Ã·"===e?(n=[1,2,3,4,5,6,7,8,9,10,11,12],o=[1,2,3,4,5,6,7,8,9,10,11,12]):(n=[0,1,2,3,4,5,6,7,8,9,10,11,12],o=[0,1,2,3,4,5,6,7,8,9,10,11,12]);const l=function(e,t,n,o){const l=document.createElement("table");l.classList.add("stats"),"-"===e&&l.classList.add("subtraction");let a=null,c=null;a=document.createElement("tr"),c=document.createElement("th"),c.innerText=e,c.addEventListener("click",(()=>R(N(e),o))),a.appendChild(c);for(let e=0;e<t.length;++e)c=document.createElement("th"),c.innerText=t[e],a.appendChild(c);l.appendChild(a);for(let s=0;s<n.length;++s){a=document.createElement("tr"),c=document.createElement("td"),c.innerText=n[s],a.appendChild(c);for(let l=0;l<t.length;++l){const c=o(t[l],e,n[s]);c&&a.appendChild(c)}l.appendChild(a)}return l}(e,n,o,t),a=document.getElementById("contents");a.innerHTML="",a.appendChild(l),H("box")}function W(e){return null==e?"unknown":e<2e3?"great":e<3e3?"good":e<6e3?"ok":"bad"}function j(e){return null==e?"unknown":e>=95?"great":e>=90?"good":e>=75?"ok":"bad"}function Y(){const e=document.createElement("table");e.className="calendar";let t=null,n=null;const o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];t=document.createElement("tr");for(let e=0;e<o.length;++e)n=document.createElement("th"),n.innerText=o[e],t.appendChild(n);e.appendChild(t);const l=y(),a=v(I(l),-21);let c=a;for(;c<=l;){t=document.createElement("tr");for(let e=0;e<7;++e){const e=document.createElement("td"),n=E(c),o=K(n===m.date?m:g[n]);let s=`<div class="date">${c===a||1===c.getDate()?c.toLocaleString("en-US",{month:"short"}):""} ${c.toLocaleString("en-US",{day:"numeric"})}</div>`;if(o&&(s+=`<svg class="fill-${o}"><use href="#star"></use</svg>`),e.innerHTML=s,t.appendChild(e),c=v(c,1),c>l)break}e.appendChild(t)}const s=document.getElementById("contents");s.innerHTML="",s.appendChild(e),H("box")}function K(e){if(null==e)return null;const t=e.count;return t>=3*u.goal?"gold":t>=2*u.goal?"silver":t>=u.goal?"bronze":null}function Q(e){if(0===e.options.length)for(let t=0;t<i.length;++t){const n=document.createElement("option");n.text=i[t],e.add(n,t)}}let X=!1;function Z(){if(!X){const e=document.getElementById("setting-goal");e.value=u.goal,e.addEventListener("input",(()=>{u.goal=parseInt(e.value),_(),k()})),""===e.value&&(e.value=40);const t=document.getElementById("setting-op");t.value=n.innerText,t.addEventListener("input",(()=>{const e=t.value;n.innerText=e,u.op=e,_(),b()}));const o=document.getElementById("setting-delay");o.value=parseInt(u.pauseMs),o.addEventListener("input",(()=>{u.pauseMs=parseInt(o.value),_()}));const l=document.getElementById("setting-volume");l.value=parseFloat(u.volume),l.addEventListener("input",(()=>{u.volume=parseFloat(l.value),_(),D(),F(s||r)}));const a=document.getElementById("setting-each-sound");Q(a),a.selectedIndex=u.oneSound,a.addEventListener("input",(()=>{u.oneSound=a.selectedIndex%i.length,_(),s=z(u.oneSound??1,s),F(s)}));const c=document.getElementById("setting-goal-sound");Q(c),c.selectedIndex=u.goalSound,c.addEventListener("input",(()=>{u.goalSound=c.selectedIndex%i.length,_(),r=z(u.goalSound??3,r),F(r)}))}X=!0,H("settings-box")}function _(){try{window.localStorage.setItem("settings",JSON.stringify(u))}catch{f||(f=!0,A("Can't save progress or settings with cookies disabled."))}}const ee={unknown:"â¬›",great:"ðŸŸ¦",good:"ðŸŸ©",ok:"ðŸŸ¨",bad:"ðŸŸ¥",gold:"ðŸŸ¨",silver:"â¬œ",bronze:"ðŸŸ§"};function te(){const e=y();let t=`${E(e)} | ${u.goal} | ${u.op}\n\n`,n=v(I(e),-7);for(t+="ðŸ“…\n";n<=e;){const e=E(n),o=e===m.date?m:g[e];t+=ee[K(o)??"unknown"],6===n.getDay()&&(t+="\n"),n=v(n,1)}t+="\n\n",q(14),t+=function(e){let t="âš¡ ",n="ðŸŽ¯ ";const o=p?.rollup?.speed[e],l=p?.rollup?.accuracy[e],a="-"===e?20:12;for(let c="Ã·"===e?1:0;c<=a;++c){const e=o?.[c];e?.sort(((e,t)=>e-t));const a=e?.[Math.floor(.75*e?.length)]??null,s=l?.[c]?.[0]/l?.[c]?.[1]*100;t+=ee[W(a)],n+=ee[j(s)]}return n+"\n"+t}(u.op),q(60);document.getElementById("share-text").innerHTML=t,h=t;let o=`mailto:?subject=Math Facts Summary&body=${encodeURIComponent(t)}`;document.getElementById("share-mail").href=o,H("share-box")}function ne(){navigator.clipboard.writeText(h),A("Copied to Clipboard!")}let oe=!1;function le(){oe||(oe=!0,F(s,0))}let ae=!1;function ce(){window.visualViewport&&window.innerHeight!==window.visualViewport.height?(ae=!0,document.getElementById("problem").style.fontSize=.12*window.visualViewport.height,document.getElementById("answer").style.fontSize=.12*window.visualViewport.height,document.getElementById("top-spacer").style.flexGrow=0):ae&&(ae=!1,document.getElementById("problem").style.fontSize="",document.getElementById("answer").style.fontSize="",document.getElementById("top-spacer").style.flexGrow=null)}window.onload=async function(){e=document.getElementById("upper"),t=document.getElementById("lower"),n=document.getElementById("op"),o=document.getElementById("answer"),l=document.getElementById("progress"),a=document.getElementById("progress-outer"),c=document.getElementById("correct-check"),C(),o.addEventListener("input",B),n.addEventListener("click",O),document.querySelectorAll(".overlay").forEach((e=>e.addEventListener("click",J))),document.querySelectorAll(".contents").forEach((e=>e.addEventListener("click",U))),document.getElementById("calendar-button").addEventListener("click",Y),document.getElementById("speed-button").addEventListener("click",(()=>R(n.innerText,G))),document.getElementById("accuracy-button").addEventListener("click",(()=>R(n.innerText,P))),document.getElementById("share-button").addEventListener("click",te),document.getElementById("help-button").addEventListener("click",(()=>H("help-box"))),document.getElementById("settings-button").addEventListener("click",Z),document.getElementById("share-clipboard").addEventListener("click",ne),document.body.addEventListener("click",le),window.addEventListener("resize",ce),window.setTimeout($,36e5),window.addEventListener("focus",M),b()};
//# sourceMappingURL=index.d4ce9458.js.map
