<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>DIY Wireguard Setup | Relentless Optimizer</title>
<meta name=keywords content><meta name=description content="We recently set up Wireguard as a home VPN. It&rsquo;s widely used, trusted, open source, and free, but I stumbled on a few things along the way and the documentation is sparse, so I wanted to write up what I did."><meta name=author content="Scott Louvau"><link rel=canonical href=https://relentlessoptimizer.com/code/2023/03/23/diy-wireguard-setup/><link href=/assets/css/stylesheet.min.0b2e0140b43ef19b2a750e921516ad4fa6709d5410537b71ea94d625d11a0ddd.css integrity="sha256-Cy4BQLQ+8ZsqdQ6SFRatT6ZwnVQQU3tx6pTWJdEaDd0=" rel="preload stylesheet" as=style><link rel=icon href=https://relentlessoptimizer.com/favicon.svg type=image/svg+xml><link rel=icon href=https://relentlessoptimizer.com/favicon-128x128.png sizes=128x128><link rel=icon href=https://relentlessoptimizer.com/favicon-32x32.png sizes=32x32><link rel=icon href=https://relentlessoptimizer.com/favicon.ico sizes=16x16><meta name=generator content="Hugo 0.126.3"><link rel=alternate hreflang=en href=https://relentlessoptimizer.com/code/2023/03/23/diy-wireguard-setup/><meta property="og:title" content="DIY Wireguard Setup"><meta property="og:description" content="We recently set up Wireguard as a home VPN. It&rsquo;s widely used, trusted, open source, and free, but I stumbled on a few things along the way and the documentation is sparse, so I wanted to write up what I did."><meta property="og:type" content="article"><meta property="og:url" content="https://relentlessoptimizer.com/code/2023/03/23/diy-wireguard-setup/"><meta property="article:section" content="code"><meta property="article:published_time" content="2023-03-23T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-23T00:00:00+00:00"></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><div class=logo><a href=/ accesskey=h title="Relentless Optimizer (Alt + H)">Relentless Optimizer</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon"><use xlink:href="/assets/icons.svg#moon"/></svg><svg id="sun"><use xlink:href="/assets/icons.svg#sun"/></svg></button></span></div><nav class=site-nav><input type=checkbox id=nav-trigger class=nav-trigger>
<label for=nav-trigger><span class=menu-icon><svg><use xlink:href="/assets/icons.svg#menu"/></svg></span></label><div class=trigger><a class=page-link href=/about title=About>About</a>
<a class=page-link href=/code/ title=Code>Code</a>
<a class=page-link href=/finance/ title=Finance>Finance</a>
<a class=page-link href=/gaming/ title=Gaming>Gaming</a>
<a class=page-link href=/life/ title=Life>Life</a>
<a class=page-link href=/retire-early title="Retire Early">Retire Early</a></div></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=/>Home</a>&nbsp;»&nbsp;<a href=/code/>Code</a></div><h1 class=post-title>DIY Wireguard Setup</h1><div class=post-meta>March 23, 2023 · 4 min · Scott Louvau</div></header><div class=post-content><p>We recently set up Wireguard as a home VPN. It&rsquo;s widely used, trusted, open source, and free, but I stumbled on a few things along the way and the documentation is sparse, so I wanted to write up what I did.</p><h2 id=outline>Outline<a hidden class=anchor aria-hidden=true href=#outline>#</a></h2><ul><li>Motivation?<ul><li>Darinee found out about my X-Mas gift.</li><li>Third party services to access house stuff remotely (OctoEverywhere, Home Assistant?)</li><li>Wanted to stop leaving home hosts exposed to internet (IotaWatt)</li></ul></li><li>Explain Wireguard<ul><li>What is it?</li><li>Why Wireguard and not different VPN software?</li><li>What can a VPN do for you, anyway?</li></ul></li><li>How we use Wireguard<ul><li>Check Printers, Cameras, Control House away from home</li><li>Netflix thinks we&rsquo;re home when away<ul><li>Haven&rsquo;t tested.</li></ul></li><li>T-Mobile doesn&rsquo;t slow video downloads when tethering<ul><li>Not working for YT Music. Seems to work for Netflix video.</li></ul></li><li>Safer browsing on public Wifi</li><li>More private browsing?<ul><li>Sort of - CAPTCHA (sp) challenges and would be same IP as others on network.</li><li>Browser fingerprint would still be the same.</li><li>Deleting cookies, blocking cookies, and disallowing sharing seemed to work better (Facebook).</li><li>Separate browser for browsing, shopping, and signed in.</li></ul></li><li>Future: Secure droplet services by locking network, not in-app authentication.</li><li>Future: House-to-house VPN tunnel</li><li>Future: Dynamic DNS setup?</li><li>Future: Wireguard on a Gateway device? (DFRobot or Seeed with OpenWRT?)</li></ul></li><li>Wireguard Setup<ul><li>Install (apt install wireguard, openresolv, qrencode)</li><li>IP forwarding (etc/sysctl.conf)</li><li>Generate keys (server and first client pairs)</li><li>Create wg0.conf</li><li>Add Firewall exception (ufw allow 51820/udp)</li><li>Create service; start on boot. (systemctl enable <a href=mailto:wg-quick@wg0.service>wg-quick@wg0.service</a>)</li><li>Generate first QR code</li><li>Set up client</li><li>Test</li></ul></li><li>Wireguard Troubleshooting<ul><li>Get public and private key backwards.</li><li>Autosave overwrites conf changes on stop.</li><li>Lock yourself out on wg-quick down wg0.</li><li>Forget to load new config on server before testing client.</li><li>Have a service on each server and private network handy.</li><li>Missing &ldquo;/24&rdquo; on [Interface] Address blocked routing.</li><li>Didn&rsquo;t know &ldquo;ip route&rdquo; commands to enable routing.</li><li>Didn&rsquo;t route from wg0 to wg0.</li><li>Use &ldquo;wg&rdquo; or Wireguard status UI to check where data is going.</li><li>Use &ldquo;ip route&rdquo; to see where traffic to a particular address would be sent.</li></ul></li><li>wg-help<ul><li>Manage keys in TSV files.</li><li>Private keys in a separate TSV (can encrypt or have each device only know its own)</li><li>One command add client, get QR code, and update servers to allow</li><li>Easy to re-generate configs for all existing servers/clients</li></ul></li><li>References<ul><li>Digital Ocean Wireguard guides</li></ul></li></ul><h2 id=what-is-wireguard>What is Wireguard?<a hidden class=anchor aria-hidden=true href=#what-is-wireguard>#</a></h2><p><a href=https://www.wireguard.com/>Wireguard</a> is VPN software - it provides encrypted network communication between clients. It is free and open source, and is used in commercial software like <a href=https://nordvpn.com/>NordVPN</a> and <a href=https://tailscale.com/>Tailscale</a>.</p><p>You can use Wireguard in a few major ways:</p><ul><li>To securely connect to your home network from anywhere</li><li>To appear to browse from home when you are somewhere else</li><li>To browse privately when you&rsquo;re on a network you don&rsquo;t trust</li><li>To &ldquo;bridge&rdquo; two private networks so that devices on one can communicate with devices on the other one transparently</li><li>To make a public server only accept connections from trusted clients.</li></ul><p>We use Wireguard to connect to our 3D printers and control our smart home server remotely. We don&rsquo;t have to pay for (or trust) any third party services, and we only open up one port on one computer (the Raspberry Pi running Wireguard) from our home network to the internet. As long as Wireguard doesn&rsquo;t have security vulnerabilities and properly rejects traffic that&rsquo;s not from one of our devices, our home network remains secure.</p><p>We can appear to browse from home even when we&rsquo;re away to keep Netflix happy that we&rsquo;re all &ldquo;one household&rdquo;, though I&rsquo;m not sure if they&rsquo;ve started enforcing the &ldquo;everyone has to watch from the same house at least monthly&rdquo; rule in the US yet.</p><p>We browse privately when away to browse from coffee shops confidently. We also use it to download video and music from tablets tethered to our phones on the go. Our cellular provider throttles or blocks video when tethered, but if we send the traffic through Wireguard, it won&rsquo;t know what kind of traffic it is. Our kids unfortunately forget to download shows and music before we leave home sometimes, and this allows us to fix the problem on the road instead of turning around.</p><h2 id=wireguard-setup>Wireguard Setup<a hidden class=anchor aria-hidden=true href=#wireguard-setup>#</a></h2><p>We have one Raspberry Pi 4 in our house and one port in our router which routes traffic to it, and Wireguard on the Pi handles authenticating clients, decrypting the traffic, and forwarding it to other devices on our home network transparently.</p><p>You need the Wireguard client installed on each device that you&rsquo;d like to be able to remotely connect to home <strong>from</strong>, so this means on each of our phones and laptops. Fortunately, Wireguard has clients for Windows, MacOS, Android, iOS, and many Linux flavors, so it&rsquo;s easy to install.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=/code/2023/02/23/aurora-projector-wi-fi-ir-remote/><span class=title>« Previous Post</span><br><span>Aurora Projector Wi-Fi IR Remote</span>
</a><a class=next href=/code/2023/05/04/dryer-done-notifications-with-home-assistant-and-iotawatt/><span class=title>Next Post »</span><br><span>Dryer Done Notifications with Home Assistant and Iotawatt</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=/>Relentless Optimizer</a>, all code <a href=/LICENSE.txt>MIT License</a></span>
<span>&#183;</span>
<span>Incessantly optimizing code, games, and finances.</span><div class=social-icons><a class=social-rss href=index.xml target=_blank title=Rss><svg><use xlink:href="/assets/icons.svg#rss"/></svg>
</a><a class=social-email href=obfuscated target=_blank title=Email><svg><use xlink:href="/assets/icons.svg#email"/></svg>
</a><a class=social-github href=https://github.com/ScottLouvau target=_blank title=Github><svg><use xlink:href="/assets/icons.svg#github"/></svg>
</a><a class=social-linkedin href=https://linkedin.com/in/scott-louvau-97846531 target=_blank title="Linked in"><svg><use xlink:href="/assets/icons.svg#linkedin"/></svg></a></div></footer><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>var mail=["mail","to:","scottlo","@","out","look","."];document.querySelectorAll(".social-email").forEach(e=>e.href=mail.join("")+"com")</script></body></html>