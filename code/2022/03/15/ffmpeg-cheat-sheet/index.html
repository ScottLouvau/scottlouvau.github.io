<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>FFMPEG Cheat Sheet | Relentless Optimizer</title>
<meta name=keywords content><meta name=description content="I&rsquo;ve been using FFMPEG to transcode gaming videos often lately, and I find the reference documentation confusing.
Cheat Sheet
Transcode for Blog
Transcode to H.264 quality 24 and mono 96 kbps AAC audio."><meta name=author content="Scott Louvau"><link rel=canonical href=https://relentlessoptimizer.com/code/2022/03/15/ffmpeg-cheat-sheet/><link href=/assets/css/stylesheet.min.0b2e0140b43ef19b2a750e921516ad4fa6709d5410537b71ea94d625d11a0ddd.css integrity="sha256-Cy4BQLQ+8ZsqdQ6SFRatT6ZwnVQQU3tx6pTWJdEaDd0=" rel="preload stylesheet" as=style><link rel=icon href=https://relentlessoptimizer.com/favicon.svg type=image/svg+xml><link rel=icon href=https://relentlessoptimizer.com/favicon-128x128.png sizes=128x128><link rel=icon href=https://relentlessoptimizer.com/favicon-32x32.png sizes=32x32><link rel=icon href=https://relentlessoptimizer.com/favicon.ico sizes=16x16><meta name=generator content="Hugo 0.135.0"><link rel=alternate hreflang=en href=https://relentlessoptimizer.com/code/2022/03/15/ffmpeg-cheat-sheet/><meta property="og:title" content="FFMPEG Cheat Sheet"><meta property="og:description" content="I&rsquo;ve been using FFMPEG to transcode gaming videos often lately, and I find the reference documentation confusing.
Cheat Sheet
Transcode for Blog
Transcode to H.264 quality 24 and mono 96 kbps AAC audio."><meta property="og:type" content="article"><meta property="og:url" content="https://relentlessoptimizer.com/code/2022/03/15/ffmpeg-cheat-sheet/"><meta property="article:section" content="code"><meta property="article:published_time" content="2022-03-15T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-15T00:00:00+00:00"></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><div class=logo><a href=/ accesskey=h title="Relentless Optimizer (Alt + H)">Relentless Optimizer</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon"><use xlink:href="/assets/icons.svg#moon"/></svg><svg id="sun"><use xlink:href="/assets/icons.svg#sun"/></svg></button></span></div><nav class=site-nav><input type=checkbox id=nav-trigger class=nav-trigger>
<label for=nav-trigger><span class=menu-icon><svg><use xlink:href="/assets/icons.svg#menu"/></svg></span></label><div class=trigger><a class=page-link href=/about title=About>About</a>
<a class=page-link href=/code/ title=Code>Code</a>
<a class=page-link href=/finance/ title=Finance>Finance</a>
<a class=page-link href=/gaming/ title=Gaming>Gaming</a>
<a class=page-link href=/life/ title=Life>Life</a>
<a class=page-link href=/retire-early title="Retire Early">Retire Early</a></div></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=/>Home</a>&nbsp;»&nbsp;<a href=/code/>Code</a></div><h1 class=post-title>FFMPEG Cheat Sheet</h1><div class=post-meta>March 15, 2022 · 3 min · Scott Louvau</div></header><div class=post-content><p>I&rsquo;ve been using FFMPEG to transcode gaming videos often lately, and I find the <a href=https://ffmpeg.org/ffmpeg-all.html>reference documentation</a> confusing.</p><h2 id=cheat-sheet>Cheat Sheet<a hidden class=anchor aria-hidden=true href=#cheat-sheet>#</a></h2><h4 id=transcode-for-blog>Transcode for Blog<a hidden class=anchor aria-hidden=true href=#transcode-for-blog>#</a></h4><p>Transcode to H.264 quality 24 and mono 96 kbps AAC audio.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>%ffmpeg% -i &#34;%in%&#34; -y -c:a aac -b:a 96k -ac 1 -c:v libx264 -crf 24 &#34;%out%&#34;
</span></span></code></pre></div><h4 id=extract-audio-as-128-kbps-mp3>Extract Audio as 128 kbps MP3<a hidden class=anchor aria-hidden=true href=#extract-audio-as-128-kbps-mp3>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>%ffmpeg% -ss %startTime% -i &#34;%in%&#34; -t %duration% -b:a 128k -y -vn &#34;%out%.mp3&#34;
</span></span></code></pre></div><h4 id=extract-video-frames-to-png>Extract Video Frames to PNG<a hidden class=anchor aria-hidden=true href=#extract-video-frames-to-png>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>%ffmpeg% -ss %startTime% -i &#34;%in%&#34; -t %duration% -vf &#34;fps=%fps%&#34; -vsync vfr -f image2 -y &#34;%outDir%\F%%03d.png&#34;
</span></span></code></pre></div><h4 id=encode-at-2x-speed>Encode at 2x Speed<a hidden class=anchor aria-hidden=true href=#encode-at-2x-speed>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>%ffmpeg% -i &#34;%in%&#34; -y -filter_complex &#34;[0:v]setpts=0.5*PTS[v];[0:a]atempo=2.0[a]&#34; -map &#34;[v]&#34; -map &#34;[a]&#34; &#34;%out%&#34;
</span></span></code></pre></div><h4 id=extremely-tiny-720p-q30-no-audio-2x-speed-05-fps>Extremely Tiny (720p, Q30, no audio, 2x speed, 0.5 fps)<a hidden class=anchor aria-hidden=true href=#extremely-tiny-720p-q30-no-audio-2x-speed-05-fps>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>%ffmpeg% -i &#34;%in%&#34; -y -an -preset veryfast -crf 30 -filter_complex &#34;[0:v]setpts=0.5*PTS[v]&#34; -map &#34;[v]&#34; -r 1/2 -s 1280x720 &#34;%out%&#34;
</span></span></code></pre></div><h4 id=add-time-overlay>Add Time Overlay<a hidden class=anchor aria-hidden=true href=#add-time-overlay>#</a></h4><p>Encode with the elapsed time shown as 24pt white Arial in mm:ss.ff format in a black box at the top right.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>%ffmpeg% -i &#34;%in%&#34; -filter_complex &#34;drawtext=x=(w-text_w-5): y=5: fontfile=arial.ttf: fontcolor=white: fontsize=24: text=&#39;%%{pts\:gmtime\:0\:%%M\\\:%%S}.%%{eif\:100*t-100*trunc(t)\:d\:2}&#39;: box=1: boxcolor=black@0.90: boxborderw=5&#34; -c:a copy -c:v libx264 -crf 24 -y &#34;%out%&#34;
</span></span></code></pre></div><p>You can write expressions for X and Y and refer to the measured text and overall video width and height (w-text_w-5).</p><p>Use <code>%{pts\:gmtime\:0\:%M\\\:%S}</code> to show elapsed time (pts) using the gmtime formatting with &ldquo;mm:ss&rdquo; format.</p><p>Use <code>%{eif\:100*t-100*trunc(t)\d:\:2}</code> to show elapsed time (t) as an integer (eif) with just hundredths of a second, padded to two digits.</p><h2 id=argument-quick-reference>Argument Quick Reference<a hidden class=anchor aria-hidden=true href=#argument-quick-reference>#</a></h2><table><thead><tr><th style=text-align:left>Argument</th><th style=text-align:left>Explanation</th></tr></thead><tbody><tr><td style=text-align:left>-i [filePath]</td><td style=text-align:left>Input File Path</td></tr><tr><td style=text-align:left>[outFilePath]</td><td style=text-align:left>Output File Path (last argument)</td></tr><tr><td style=text-align:left>-ss 00:01:30.5</td><td style=text-align:left>Start Time [put <strong>before -i</strong>]</td></tr><tr><td style=text-align:left>-t 00:30:00</td><td style=text-align:left>Duration to Transcode [hh:mm:ss.ffff]</td></tr><tr><td style=text-align:left>-y</td><td style=text-align:left>Overwrite output if already present</td></tr><tr><td style=text-align:left>-c:a copy</td><td style=text-align:left>Audio: Copy to output as-is</td></tr><tr><td style=text-align:left>-c:a aac</td><td style=text-align:left>Audio: Encode as AAC (or: mp3, opus)</td></tr><tr><td style=text-align:left>-b:a 96k</td><td style=text-align:left>Audio: Encode at 96 kbps</td></tr><tr><td style=text-align:left>-ac 1</td><td style=text-align:left>Audio: Downmix to one channel (mono)</td></tr><tr><td style=text-align:left>-an</td><td style=text-align:left>Audio: Remove audio entirely</td></tr><tr><td style=text-align:left>-c:v libx264</td><td style=text-align:left>Video: Encode as H.264</td></tr><tr><td style=text-align:left>-crf 24</td><td style=text-align:left>Video: Quality to 24 (lower is better)</td></tr><tr><td style=text-align:left>-s 1280x720</td><td style=text-align:left>Video: Scale to 1280x720</td></tr><tr><td style=text-align:left>-r 5</td><td style=text-align:left>Video: Framerate to 5 fps. (&lsquo;1/5&rsquo; for 0.2 fps)</td></tr><tr><td style=text-align:left>-vn</td><td style=text-align:left>Video: Remove video entirely</td></tr></tbody></table><h2 id=codecs-and-quality>Codecs and Quality<a hidden class=anchor aria-hidden=true href=#codecs-and-quality>#</a></h2><p>Experiments on a nine minute 1080p recording of Kingdom Rush using Xbox Game Bar, which was originally <strong>500 MB</strong>.
Every 128 kbps (for video plus audio) is 960 KB per minute.</p><table><thead><tr><th style=text-align:left>Video Q (h.264)</th><th style=text-align:left>Perception</th><th style=text-align:left>Video kbps</th><th style=text-align:left>Out Size</th></tr></thead><tbody><tr><td style=text-align:left>22</td><td style=text-align:left>Excellent</td><td style=text-align:left>1,135</td><td style=text-align:left>75 MB</td></tr><tr><td style=text-align:left>24</td><td style=text-align:left>Great</td><td style=text-align:left>820</td><td style=text-align:left>54 MB</td></tr><tr><td style=text-align:left>27</td><td style=text-align:left>Good</td><td style=text-align:left>600</td><td style=text-align:left>40 MB</td></tr><tr><td style=text-align:left>30</td><td style=text-align:left>OK</td><td style=text-align:left>450</td><td style=text-align:left>30 MB</td></tr><tr><td style=text-align:left>32</td><td style=text-align:left>Bad</td><td style=text-align:left>350</td><td style=text-align:left>23 MB</td></tr></tbody></table><table><thead><tr><th style=text-align:left>Audio kbps</th><th style=text-align:left>Codec</th><th style=text-align:left>Perception</th><th style=text-align:left>Out Size</th></tr></thead><tbody><tr><td style=text-align:left>128 (stereo)</td><td style=text-align:left>AAC</td><td style=text-align:left>Excellent</td><td style=text-align:left>8.4 MB</td></tr><tr><td style=text-align:left>96 (mono)</td><td style=text-align:left>AAC</td><td style=text-align:left>Excellent</td><td style=text-align:left>6.3 MB</td></tr><tr><td style=text-align:left>64 (mono)</td><td style=text-align:left>AAC</td><td style=text-align:left>Fine</td><td style=text-align:left>4.2 MB</td></tr><tr><td style=text-align:left>48 (mono)</td><td style=text-align:left>AAC</td><td style=text-align:left>Bad</td><td style=text-align:left>3.2 MB</td></tr><tr><td style=text-align:left>96 (stereo)</td><td style=text-align:left>Opus</td><td style=text-align:left>Excellent</td><td style=text-align:left>6.3 MB</td></tr><tr><td style=text-align:left>64 (stereo)</td><td style=text-align:left>Opus</td><td style=text-align:left>Great</td><td style=text-align:left>4.2 MB</td></tr><tr><td style=text-align:left>48 (stereo)</td><td style=text-align:left>Opus</td><td style=text-align:left>Fine (detectable)</td><td style=text-align:left>3.2 MB</td></tr><tr><td style=text-align:left>32 (stereo)</td><td style=text-align:left>Opus</td><td style=text-align:left>Stereo &lsquo;Full Band&rsquo; lower limit</td><td style=text-align:left>2.1 MB</td></tr><tr><td style=text-align:left>24 (mono)</td><td style=text-align:left>Opus</td><td style=text-align:left>Speech ok, music weird</td><td style=text-align:left>1.6 MB</td></tr><tr><td style=text-align:left>192 (stereo)</td><td style=text-align:left>MP3</td><td style=text-align:left>Excellent</td><td style=text-align:left>12.6 MB</td></tr><tr><td style=text-align:left>128 (stereo)</td><td style=text-align:left>MP3</td><td style=text-align:left>Fine</td><td style=text-align:left>8.4 MB</td></tr><tr><td style=text-align:left>96 (mono)</td><td style=text-align:left>MP3</td><td style=text-align:left>Fine</td><td style=text-align:left>6.3 MB</td></tr></tbody></table><p>MP3 is fine down to 128 kbps stereo, 96 kbps mono. AAC is fine down to 96 kbps stereo, 64 kbps mono. Opus is fine down to 64 kbps stereo, ~48 kbps mono, ~24 kbps mono speech only. Quality seems to drop quickly below those thresholds. Opus isn&rsquo;t supported everywhere, but AAC is.</p><p><a href=https://support.spotify.com/us/article/audio-quality/>Spotify</a> defaults are 128 kbps AAC (Web) or 96 kbps (Mobile, &ldquo;Normal&rdquo; quality).</p><p>At lower video quality (Q30), 1080p is 450 kbps and 720p is 260 kbps. At those rates, 128 kbps audio becomes big, so encoding to 96 kbps or 64 kbps mono is important to file size.</p></div><footer class=post-footer><nav class=paginav><a class=prev href=/gaming/2022/02/16/optimizing-kingdom-rush/><span class=title>« Previous Post</span><br><span>Optimizing Kingdom Rush</span>
</a><a class=next href=/life/2022/05/04/m1-macbooks-charge-from-anything/><span class=title>Next Post »</span><br><span>M1 MacBooks charge from anything!</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=/>Relentless Optimizer</a>, all code <a href=/LICENSE.txt>MIT License</a></span>
<span>&#183;</span>
<span>Incessantly optimizing code, games, and finances.</span><div class=social-icons><a class=social-rss href=index.xml target=_blank title=Rss><svg><use xlink:href="/assets/icons.svg#rss"/></svg>
</a><a class=social-email href=obfuscated target=_blank title=Email><svg><use xlink:href="/assets/icons.svg#email"/></svg>
</a><a class=social-github href=https://github.com/ScottLouvau target=_blank title=Github><svg><use xlink:href="/assets/icons.svg#github"/></svg>
</a><a class=social-linkedin href=https://linkedin.com/in/scott-louvau-97846531 target=_blank title="Linked in"><svg><use xlink:href="/assets/icons.svg#linkedin"/></svg></a></div></footer><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>var mail=["mail","to:","scottlo","@","out","look","."];document.querySelectorAll(".social-email").forEach(e=>e.href=mail.join("")+"com")</script></body></html>